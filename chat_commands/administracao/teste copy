const { EmbedBuilder } = require("discord.js");
module.exports = {
  config: {
    name: "reagir3",
    aliases: []
  },
  run: async (bot, message, args) => {
    const canalID = args[0];
    const mensagemID = args[1];
    const emojiEscolhido = args[2];
    const cargoID = args[3];

    if (!canalID || !mensagemID || !emojiEscolhido || !cargoID) {
      return message.reply("Por favor, forneça o ID do canal, da mensagem, do emoji e do cargo.").then(repliedMessage => {
        setTimeout(() => repliedMessage.delete(), 5000);
        setTimeout(() => message.delete(), 5000);
      });
    }

    try {
      const canal = await bot.channels.fetch(canalID);
      
      if (!canal || !canal.isTextBased()) {
        return message.reply("Não consegui encontrar um canal com esse ID ou o canal não é de texto.").then(repliedMessage => {
          setTimeout(() => repliedMessage.delete(), 5000);
          setTimeout(() => message.delete(), 5000);
        });
      }

      const mensagemParaReagir = await canal.messages.fetch(mensagemID);
      
      if (!mensagemParaReagir) {
        return message.reply("Não consegui encontrar a mensagem com esse ID.").then(repliedMessage => {
          setTimeout(() => repliedMessage.delete(), 5000);
          setTimeout(() => message.delete(), 5000);
        });
      }

      // Adiciona a reação
      await mensagemParaReagir.react(emojiEscolhido);

      // Armazena os dados globalmente no bot
      bot.mensagemID = mensagemID;
      bot.emojiEscolhido = emojiEscolhido;
      bot.cargoID = cargoID;

    } catch (err) {
      console.error(err);
      message.reply("Houve um erro ao tentar reagir à mensagem. Verifique o ID do canal e da mensagem e tente novamente.")
        .then(repliedMessage => {
          setTimeout(() => repliedMessage.delete(), 5000);
          setTimeout(() => message.delete(), 5000);
        });
    }
  },
};
